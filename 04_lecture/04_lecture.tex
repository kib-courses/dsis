\input{./../header/kib.tex}
\input{./../header/user.tex}

\title{Лекция 4. UEBA: анализ непрерывных потоков (track analysis). Mouse Track Analysis. Mobile Entity Analitics}

% \date{\today}
\date{22 октября 2019}
\author{Павел Владимирович Слипенчук \\ Ольга Сергеевна Шкряба}
\institute{Москва, МГТУ им.Бауманка,\\ каф.ИУ-8, \href{https://t.me/kibinfo}{КИБ}}
% \titlegraphic{\includegraphics[width=2cm]{logo_ur.jpg}}
\titlegraphic{\small \href{https://github.com/kib-courses/dsis}{Data Science для решения задач информационной безопасности}}

\begin{document}
  \maketitle
    
\begin{frame}{План лекции}
    \begin{enumerate}
    	\item \nameref{section:ueba}
    	\item \nameref{section:mca}
		\item \nameref{section:mea}
		\item \nameref{section:ueba_other}
	\end{enumerate}
\end{frame}

\section{UEBA}\label{section:ueba}
	\begin{center}
		\includegraphics[width=7cm]{../pic/Jackie_Chan.png}
		
		\LARGE
		\auditorium{UEBA?}
	\end{center}

\begin{frame}{User and Entity Behavioral Analitics}

	\termdef{Потоковые данные} (stream data) -- 
	<<локально связные данные>> пользовательской активности
	(трек мыши, последовательность действий, keystroke dynamics и т.д.)
	
	\begin{equation*}
	track~data \subseteq stream~data \subseteq raw~data
	\end{equation*}
	
	\termdef{Поведенческая аналитика}, User and Entity Behavioral Analitics (UEBA) --
	процесс сбора, ручного анализа и построения экспертных систем
	основанных на больших объёмов \term{потоковых данных}, генерируемые пользовательскими приложениями
\end{frame}

\begin{frame}{Примеры UEBA в ИБ}
	\begin{enumerate}
		\item MTA (Mouse Track Analysis) --
		анализ трека мыши.
		Например на Web-портале (в частности ДБО).
		\item keystroke dynamics --
		анализ клавиатурного почерка.
		Например при вводе логина и пароля в ДБО.
		\item predilections (предпочтения) --
		предпочтения пользователя. 
		Например как копирует информацию: ctrl+v, shift+insert или кнопка мыши + "вставить"?
	\end{enumerate}
\end{frame}

\begin{frame}{Определение точности для задачи идентификации}
	\small
	Пусть имеется множество классов (не обязательно два): $1, 2, 3, ..., n$.
	
	Введём события:
	\begin{itemize}
		\item $L_r^i$ -- событие, что объект действительно пренадлежит классу $i$;
		\item $L_s^i$ -- событие, что экспертная система определила событие к классу $i$.
	\end{itemize}
	
	Тогда \termdef{точность обнаружения своих для класса $i$} ($T$)
	% и \termdef{полнота обнаружения для класса $i$} ($\Pi$)
	определяется по формуле:
	\begin{equation}
	\hat T_i \stackrel{def}{=} P (L_r^i | L_s^i)
	\end{equation}
	% \begin{equation}
	% \Pi_i \stackrel{def}{=} P (L_s^i | L_r^i)
	% \end{equation}
\end{frame}

\begin{frame}
	\small
	Определим операцию $[cond]$: 
	\begin{itemize}
		\item $[cond]=1$ если $cond$ истинно 
		\item $[cond]=0$, если $cond$ ложно
	\end{itemize}
	
	определим величину $refusal \in [0, 1]$.
	
	Будем считать, что $n >> 0$.
	
	Тогда \termdef{точность обнаружения своих} при отказе $refusal$ это такая максимально
	возможная величина $\hat T$, что выполняется уравнение:
	\begin{equation}\label{eq:ueba_self_precision_equation}
	\frac{\sum_{i=1}^{n} \left[\hat T_i > 
		\hat T\right]}{n} \geqslant 1 -  refusal
	\end{equation}
	Так как эта величина \term{максимально возможная}, то
	разумно формулу \eqref{eq:ueba_self_precision_equation} 
	переписать так:
	\begin{equation}
	\frac{\sum_{i=1}^{n} \left[\hat T_i > 
		\hat T\right]}{n} = 1 -  refusal
	\end{equation}
	
\end{frame}

\begin{frame}
	\Large
	На практике интересны системы. для которых 
	\term{точность для своих} $ \approx 99.9...9\%$.
	
	\begin{center}
		\auditorium{Почему?}
	\end{center}
	Таким образом важным параметром является величина отказа
	(величина $refusal$)
	
	Таким образом разумно зафиксировать 
	$ \hat T = 99.9...9\%$ и уже \textbf{после}
	подбирать $refusal$.
	
	\auditorium{Объясните физический смысл значения refusal в этом случае.}
\end{frame}

\begin{frame}{Точность [определения чужих]}
	\small
	Предположим, что в некоторой системе под учётной записью 
	работает \termdef{другой} человек.
	Не факт, что это фрод (событие F -- fraud).
	
	Обозначим его через букву $A$ (от англ \textbf{another} или \textbf{anomaly})
	
	Введём ещё два события:
	\begin{itemize}
		\item $A_r^i$ (another) -- событие, что в действительности под учётной записью $i$
		работает пользователь $\neq i$;
		\item $A_s^i$ (anomaly)-- событие, что экспертная система определила событие
		как аномальное для пользователя $i$
	\end{itemize}

	Тогда \termdef{точность [для определения чужих]}	
	для пользователя $i$	

	\begin{equation}
	\hat T_i \stackrel{def}{=} P (A_r^i | A_s^i)
	\end{equation}
\end{frame}

\begin{frame}{Точность [определения чужих]}
	\small
	Возьмём все классы, которые не попадают в $refusal$.
	
	Определим величину $n_1$:
	\begin{equation}
	n_1 \stackrel{def}{=} \sum_{i=1}^{i=n} \left[\hat T_i > \hat T \right]	
	\end{equation}
	
	\auditorium{ДЗ. Докажите, что верно уравнение}:
	\begin{equation}
	refusal = 1 - \frac{n_1}{n}
	\end{equation}
	
	Точностью [определения чужих] считается средняя величина:
	\begin{equation}\label{eq:ueba_presicion_def}
	T = \frac{\sum_{i=1}^{n} T_i \cdot \left [\hat{T_i} > \hat T \right]}{n_1} 
	\end{equation}
	
	Или медиана.
	\auditorium{ДЗ. Самостоятельно напишите формулу, аналогичную \eqref{eq:ueba_presicion_def}}
\end{frame}

\begin{frame}{Примеры ошибок}
	\small
	\begin{enumerate}
		\item очень часто просто не декларируется величина отказ ($refusal$).
		Это абсурд. Всегда есть странные сессии и даже странные пользователи,
		для которых  UEBA не применимо в принципе
		\item путают точность для своих и точность [для чужих]
		\item не понимают, что почти всегда $\hat T$ должна равняетcя почти $1$.
		И уже из этого соображения рассчитывать $refusal$.
		\item точность [для чужих] можно рассчитывать как мат.ожидание, так и как медиана.
		Или другим способом.
		Иногда существует большой класс данных для которых точность неверноятно мала 
		(например 2/3), но для другой части (напирмер 1/3) точность очень высока (например $T=90\%$)
		Очевидно что такая система имеет практическую пользу 
		(при не очень большом $refusal$ разумеется), однако медиана будет очень низкой,
		а средняя величина всего чуть больше $30\%$.
	\end{enumerate}
\end{frame}

\begin{frame}{Фундаментальная проблема всех UEBA решений}
\begin{block}{<<Очень важное замечание.>> (О.В.З)}
	Обычно \href{https\%3A\%2F\%2Fru.wikipedia.org\%2Fwiki\%2F\%D0\%9F\%D1\%80\%D0\%BE\%D0\%BA\%D0\%BB\%D1\%8F\%D1\%82\%D0\%B8\%D0\%B5_\%D1\%80\%D0\%B0\%D0\%B7\%D0\%BC\%D0\%B5\%D1\%80\%D0\%BD\%D0\%BE\%D1\%81\%D1\%82\%D0\%B8}{Проклятье Размерности (ПР)}
	рассматривают проблему количества признаков в Data Science.
	
	Однако частный случай ПР -- это большое количество \term{классов}.
	Многие задачи тривиально решаются при малом количестве классов, 
	но полнота и точность падают к 0\% при существенном увеличении количества классов.
	
	Не обольщайтесь на академические работы!
\end{block}
\end{frame}

\begin{frame}{Сказка, основанная на трёх разных реальных событиях}
	\small
	Жыла была мышь-датасаентолог. 
	
	Мышь решила создать UEBA систему распознования почерка движения мыши(компьютерной) 
	для мышей(настоящих). 
	
	Мышь собрала своих друзей мышек, 
	которые по 30 минут играли в игру, используя мышь(компьютерную).
	
	$refusal$ у него $0\%$ (датасаентолог и не думывал рассчитывать эту величину),
	$\hat T = 100\%$, а вот средняя $T = 76\%$.
	
	Датасантолог идет в фонд <<Скольково>>. 
	Фонд <<Cкольково>> даёт грант на дофига тугриков для внедрения 
	в ДБО <<ЛТБ>> (Лучший банк тушканчиков),
	в котором обслуживаются 5 млн. тушканчиков.
	
	В конце epic fail: система не заработала. \auditorium{Почему?}
\end{frame}


\section{Mouse Track Analysis}\label{section:mca}


\section{Mobile Entity Analitics}\label{section:mea}
% TODO часть Ольги Шкряба

\section{Другие UEBA задачи анализа непрерывных потоков}\label{section:ueba_other}
% Eye Tracking
% Полиграф
% ...

\section{Вопросы для самопроверки}

\end{document}